# =========================================================
# 日本全市场扫描器配置（已加中文说明版）
# =========================================================

# -------------------- 基础路径与应用行为 --------------------
# 输出文件的根目录（日志、报告、数据库都会放在这里）
outputs.dir=outputs
# SQLite 数据库文件路径（相对 outputs.dir 或当前工作目录）
db.path=outputs/stockbot.db
# 是否打印 SQL 日志（排查数据库问题时很有用）
db.sql_log.enabled=true
# HTML 报告输出目录
report.dir=outputs/reports
# 盘中模式是否隐藏入场价相关字段（true=隐藏）
report.mode.intraday.hideEntry=true
# 自选股文件路径
watchlist.path=watchlist.txt
# 应用时区（影响调度时间与报告时间显示）
app.zone=Asia/Tokyo
# 应用模式（DAILY=日常运行，BACKTEST=回测）
app.mode=DAILY
# 是否启用内置调度（无参数启动 DAILY 时通常也会进入调度）
app.schedule.enabled=false
# 是否在启动时重置批处理断点（谨慎使用）
app.reset_batch=false
# 启动时临时覆盖 topN（0 表示不覆盖）
app.top_n_override=0
# 背景扫描开关（当前代码中主要由调度路径控制）
app.background_scan.enabled=false
# 背景扫描时间间隔秒数（保留项，当前已改为按启动/运行触发）
app.background_scan.interval_sec=86400
# 背景扫描时是否强制更新股票池
app.background_scan.force_universe_update=false
# 背景扫描时临时覆盖 topN（0 表示不覆盖）
app.background_scan.top_n_override=0

# -------------------- JPX 股票池更新 --------------------
# JPX 股票池源数据地址
jpx.universe.url=https://www.jpx.co.jp/markets/statistics-equities/misc/tvdivq0000001vg2-att/data_j.xls
# 股票池自动刷新间隔（天）
jpx.universe.refresh_days=7
# 是否每次都强制刷新股票池
jpx.universe.force_update=false
jpx.universe.request_timeout_sec=20
# -------------------- Yahoo Market Data --------------------
# Yahoo daily bars (ticker mapping handled by code)
# Yahoo 日线接口模板（ticker 映射由代码处理）
yahoo.max_bars_per_ticker=300

# -------------------- 扫描主流程 --------------------
# 扫描并发线程数
scan.threads=3
# 最终候选输出数量
scan.top_n=15
# 报告中市场参考候选数量
scan.market_reference_top_n=5
# 限制最大扫描股票数（0=不限制）
scan.max_universe_size=0
# 计算指标要求的最小历史 K 线数量
scan.min_history_bars=180
# 数据新鲜度阈值（天）
scan.fresh_days=2
# 是否优先使用本地缓存
scan.cache.prefer_enabled=true
# 缓存可接受的新鲜天数
scan.cache.fresh_days=2
# 如果有缓存，是否仍然走网络重试
scan.network.retry_when_cache_exists=false
# 首次入库时写入的历史天数
scan.upsert.initial_days=300
# 增量更新时默认回看天数
scan.upsert.incremental_recent_days=10
# 增量更新时额外重叠天数（防止漏数据）
scan.upsert.incremental_overlap_days=2
# 可交易性过滤：20日平均成交量下限
scan.tradable.min_avg_volume_20=50000
# 可交易性过滤：价格下限
scan.tradable.min_price=100
# 可交易性过滤：20日内允许的零成交天数上限
scan.tradable.max_zero_volume_days_20=3
# 可交易性过滤：横盘检测回看天数
scan.tradable.flat_lookback_days=5
# 可交易性过滤：允许横盘天数上限
scan.tradable.max_flat_days=3
# 全局价格下限过滤
scan.min_price=100
# 全局价格上限过滤
scan.max_price=100000
# 全局平均成交量下限过滤
scan.min_avg_volume=50000
# 候选最低评分阈值
scan.min_score=55
# 是否开启分段批处理扫描
scan.batch.enabled=true
# 是否按市场分组切段（false 表示固定块切分）
scan.batch.segment_by_market=false
# 每段块大小（条数）
scan.batch.market_chunk_size=150
# 是否启用断点续扫
scan.batch.resume_enabled=true
# 每次 run 最多处理多少段（0=处理全部段）
scan.batch.max_segments_per_run=0
# 断点续扫在 metadata 中使用的 key
scan.batch.checkpoint_key=daily.scan.batch.checkpoint.v1
# 每处理多少只股票打印一次进度日志
scan.progress.log_every=25
# 自选股价格重复告警阈值（重复数量达到后标记可疑）
watchlist.price.duplicate_min_count=2

# -------------------- 候选过滤规则 --------------------
# 至少满足多少个信号才保留
filter.min_signals=3
# 近3日最大跌幅硬阈值（%）
filter.hard.max_drop_3d_pct=-8
# 回调阈值（%）
filter.pullback_threshold_pct=-8
# 最大回撤阈值（%）
filter.max_drawdown_pct=-45
# RSI 下限
filter.rsi_floor=20
# RSI 上限
filter.rsi_ceiling=55
# 当前价相对 SMA20 允许偏离上限（%）
filter.max_pct_from_sma20=2
# 当前价相对 SMA60 允许偏离上限（%）
filter.max_pct_from_sma60=6
# 与布林带接近阈值（%）
filter.band_proximity_pct=3

# -------------------- 风险过滤与惩罚 --------------------
# ATR 占比上限（%）
risk.max_atr_pct=9
# 波动率上限（%）
risk.max_volatility_pct=80
# 回撤上限（%）
risk.max_drawdown_pct=60
# 成交量比例下限
risk.min_volume_ratio=0.3
# ATR 超限失败倍数
risk.fail_atr_multiplier=1.5
# 波动率超限失败倍数
risk.fail_volatility_multiplier=1.4
# ATR 风险惩罚缩放系数
risk.penalty.atr_scale=1.7
# ATR 风险惩罚上限
risk.penalty.atr_cap=18
# 波动率惩罚缩放系数
risk.penalty.volatility_scale=0.45
# 波动率惩罚上限
risk.penalty.volatility_cap=18
# 回撤惩罚缩放系数
risk.penalty.drawdown_scale=1.1
# 回撤惩罚上限
risk.penalty.drawdown_cap=22
# 流动性不足固定惩罚分
risk.penalty.liquidity=12
# 风险评估中的最低成交量阈值
risk.minVolume=50000
# 风险评估中的最大波动率阈值（比例）
risk.volMax=0.06

# -------------------- 仓位与盈亏比 --------------------
# 单笔仓位上限（比例，如 0.05=5%）
position.single.maxPct=0.05
# 总仓位上限（比例，如 0.50=50%）
position.total.maxPct=0.50
# 报告展示用单笔仓位上限（百分比）
report.position.max_single_pct=5.0
# 报告展示用总仓位上限（百分比）
report.position.max_total_pct=50.0
# 最低盈亏比要求
rr.min=1.5
# 盈亏比底线（防止配置过低）
plan.rr.min_floor=1.1
# 入场缓冲百分比
plan.entry.buffer_pct=0.5
# 止损 ATR 倍数
plan.stop.atr_mult=1.5
# 目标价使用 high_lookback 的倍率
plan.target.high_lookback_mult=0.98
# 止损回看天数
stop.loss.lookbackDays=20
# 止损缓冲比例
stop.loss.bufferPct=0.02

# -------------------- 评分权重 --------------------
# 回调因子权重
score.weight_pullback=0.22
# RSI 因子权重
score.weight_rsi=0.23
# 均线偏离因子权重
score.weight_sma_gap=0.16
# 布林带因子权重
score.weight_band=0.14
# 反弹因子权重
score.weight_rebound=0.12
# 成交量因子权重
score.weight_volume=0.13

# -------------------- 邮件发送 --------------------
# 是否启用邮件发送
email.enabled=true
# SMTP 服务器地址
email.smtp_host=smtp.gmail.com
# SMTP 端口
email.smtp_port=587
# SMTP 登录用户名
email.smtp_user=zy32tang@gmail.com
# SMTP 登录密码或授权码
email.smtp_pass=qmcbosslbyttwrnk
# 发件人地址
email.from=zy32tang@gmail.com
# 收件人地址（多个可逗号分隔）
email.to=zy32tang@gmail.com
# 邮件主题前缀
email.subject_prefix=[StockBot JP]

# -------------------- 报告行为 --------------------
# Top5 最低抓取覆盖率（%）
report.top5.min_fetch_coverage_pct=80
# 市场扫描为 PARTIAL 时是否跳过 Top5
report.top5.skip_on_partial=true
# PARTIAL 时覆盖率达到该值才允许不跳过（101 等于基本不放行）
report.top5.allow_partial_when_coverage_ge=101
# 报告是否显示覆盖范围说明
report.coverage.show_scope=true
# 是否启用 Top5 绩效指标块
report.metrics.top5_perf.enabled=false
# Top5 近30日胜率（展示值，非自动计算）
report.metrics.top5_perf.win_rate_30d=0
# Top5 近30日最大回撤（展示值，非自动计算）
report.metrics.top5_perf.max_drawdown_30d=0
# 行动建议：抓取覆盖率低风险阈值（%）
report.advice.fetch_low_pct=50
# 行动建议：指标覆盖率低风险阈值（%）
report.advice.indicator_low_pct=50
# 行动建议：抓取覆盖率告警阈值（%）
report.advice.fetch_warn_pct=80
# 行动建议：小仓试错候选数上限
report.advice.candidate_try_max=4
# 行动建议：小仓试错平均分阈值
report.advice.avg_score_try_threshold=72
# 分层标签：关注阈值
report.score.tier.focus_threshold=80
# 分层标签：观察阈值
report.score.tier.observe_threshold=65

# -------------------- 自选股（新闻与 AI） --------------------
# 新闻抓取语言
watchlist.news.lang=ja
# 新闻抓取地区
watchlist.news.region=JP
# 每只股票最多抓取新闻条数
watchlist.news.max_items=12
# 新闻来源列表（逗号分隔）
watchlist.news.sources=google,bing,yahoo
# 每只股票新闻查询变体数量
watchlist.news.query_variants=2
# 非日股处理方式（PROCESS_SEPARATELY=单独处理）
watchlist.non_jp_handling=PROCESS_SEPARATELY
# 纯字母代码默认市场（比如 US）
watchlist.default_market_for_alpha=US
# 本地大模型服务地址
watchlist.ai.base_url=http://127.0.0.1:11434
# 使用的大模型名称
watchlist.ai.model=llama3.1:latest
# AI 请求超时秒数
watchlist.ai.timeout_sec=180
# AI 最大输出 token
watchlist.ai.max_tokens=80
# AI 摘要最大字符数
watchlist.ai.max_chars=900
# 触发 AI 的评分阈值
watchlist.ai.score_threshold=-2.0
# 触发 AI 的最低新闻条数
watchlist.ai.news_min=8
# 触发 AI 的跌幅阈值（%）
watchlist.ai.drop_pct_threshold=-2.0

# -------------------- Polymarket 解释层 --------------------
# 是否启用 Polymarket 信号
polymarket.enabled=true
# Polymarket Gamma API 地址
polymarket.gamma_base_url=https://gamma-api.polymarket.com
# Polymarket Data API 地址
polymarket.data_base_url=https://data-api.polymarket.com
# 主题关键词（逗号分隔）
polymarket.keywords=semiconductor,tariffs,japan,china,supply chain
# 搜索返回上限
polymarket.search_limit=40
# 报告中展示的主题条数
polymarket.top_n=3
# Polymarket 请求超时秒数
polymarket.timeout_sec=12
# 自定义主题映射文件路径（留空表示不用）
polymarket.topic_map_path=
# 影响判定模式（rule / 其他模式）
polymarket.impact.mode=rule
# 每个主题最多展示几条 watchlist 影响
polymarket.watch_impact_limit=4

# -------------------- 内置调度 --------------------
# 调度时区
schedule.zone=Asia/Tokyo
# 每日触发时间点（逗号分隔）
schedule.times=11:30,15:00
# 备用单时间配置（当 schedule.times 为空时使用）
schedule.time=16:30

# -------------------- 回测 --------------------
# 回测使用最近多少次 run
backtest.lookback_runs=30
# 每次 run 取前多少名做回测
backtest.top_k=5
# 回测持有天数
backtest.hold_days=10
